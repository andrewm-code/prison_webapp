<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>One-Sentence Prison</title>
    <style>
        body {
            font-family: 'Times New Roman', serif;
            font-size: 14px;
            background-color: #ffffff;
            color: #000000;
            margin: 20px;
            line-height: 1.4;
            transition: background-color 0.3s, color 0.3s;
        }

        body.dark-mode {
            background-color: #1a1a1a;
            color: #e0e0e0;
        }

        h1 {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            color: #000080;
        }

        body.dark-mode h1 {
            color: #4da6ff;
        }

        .subtitle {
            text-align: center;
            font-size: 12px;
            color: #666666;
            margin-bottom: 20px;
            font-style: italic;
        }

        body.dark-mode .subtitle {
            color: #999999;
        }

        table {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            border-collapse: collapse;
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            margin: 15px 0;
            padding: 10px;
            border: 1px solid #cccccc;
            background-color: #f0f0f0;
            gap: 10px;
        }

        body.dark-mode .controls {
            border-color: #444444;
            background-color: #2a2a2a;
        }

        .btn {
            border: 2px outset #cccccc;
            padding: 6px 12px;
            font-size: 12px;
            cursor: pointer;
            font-family: 'Times New Roman', serif;
            border-radius: 3px;
        }

        .finish-btn {
            background-color: #cccccc;
        }

        .finish-btn:active {
            border: 2px inset #cccccc;
        }

        .reset-btn {
            background-color: #ffcccc;
        }

        .reset-btn:active {
            border: 2px inset #ffcccc;
        }

        .copy-btn {
            background-color: #ccffcc;
        }

        .copy-btn:active {
            border: 2px inset #ccffcc;
        }

        .copy-btn:disabled {
            background-color: #f0f0f0;
            color: #999999;
            cursor: not-allowed;
        }

        .toggle-btn {
            background-color: #ffeecc;
        }

        .save-btn {
            background-color: #e6ccff;
        }

        .load-btn {
            background-color: #ffe6cc;
        }

        body.dark-mode .btn {
            border-color: #555555;
            color: #e0e0e0;
        }

        body.dark-mode .finish-btn {
            background-color: #444444;
        }

        body.dark-mode .reset-btn {
            background-color: #664444;
        }

        body.dark-mode .copy-btn {
            background-color: #446644;
        }

        .completed-sentences {
            min-height: 150px;
            max-height: 200px;
            overflow-y: auto;
            border: 2px inset #cccccc;
            padding: 10px;
            background-color: #f9f9f9;
            margin-bottom: 10px;
            font-family: 'Comic Sans MS', cursive;
            font-size: 14px;
            line-height: 1.6;
        }

        body.dark-mode .completed-sentences {
            border-color: #444444;
            background-color: #2a2a2a;
        }

        .text-block {
            transition: opacity 0.3s ease;
        }

        .text-block.visible {
            opacity: 1;
        }

        .text-block.typewriter-mode {
            opacity: 0.2;
        }

        .current-sentence {
            background-color: #ffffcc;
            padding: 2px 4px;
            border-radius: 3px;
        }

        body.dark-mode .current-sentence {
            background-color: #4a4a00;
        }

        #currentSentence {
            width: 100%;
            height: 80px;
            border: 2px inset #cccccc;
            padding: 10px;
            font-family: 'Comic Sans MS', cursive;
            font-size: 16px;
            background-color: #ffffff;
            resize: none;
        }

        #currentSentence:focus {
            background-color: #ffffcc;
            outline: none;
        }

        body.dark-mode #currentSentence {
            border-color: #444444;
            background-color: #2a2a2a;
            color: #e0e0e0;
        }

        body.dark-mode #currentSentence:focus {
            background-color: #3a3a00;
        }

        .stats {
            margin-top: 10px;
            padding: 5px;
            border: 1px solid #cccccc;
            background-color: #f8f8f8;
            font-size: 12px;
            text-align: center;
        }

        body.dark-mode .stats {
            border-color: #444444;
            background-color: #2a2a2a;
        }

        .instructions {
            background-color: #e6f3ff;
            border: 1px solid #99ccff;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 5px;
            font-size: 12px;
        }

        body.dark-mode .instructions {
            background-color: #1a2a3a;
            border-color: #336699;
        }

        .goals-section {
            background-color: #fff0e6;
            border: 1px solid #ffcc99;
            padding: 8px;
            margin-bottom: 10px;
            border-radius: 5px;
            font-size: 12px;
        }

        body.dark-mode .goals-section {
            background-color: #2a1a0a;
            border-color: #996633;
        }

        .prompt-section {
            background-color: #f0fff0;
            border: 1px solid #99cc99;
            padding: 8px;
            margin-bottom: 10px;
            border-radius: 5px;
            font-size: 12px;
        }

        body.dark-mode .prompt-section {
            background-color: #0a2a0a;
            border-color: #336633;
        }

        .timer-display {
            font-weight: bold;
            color: #0066cc;
        }

        body.dark-mode .timer-display {
            color: #4da6ff;
        }

        .goal-input {
            width: 60px;
            padding: 2px;
            margin: 0 5px;
            border: 1px solid #999999;
            font-family: 'Times New Roman', serif;
        }

        body.dark-mode .goal-input {
            border-color: #666666;
            background-color: #333333;
            color: #e0e0e0;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin: 5px 0;
        }

        .progress-fill {
            height: 100%;
            background-color: #4da6ff;
            transition: width 0.3s ease;
        }

        body.dark-mode .progress-bar {
            background-color: #444444;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            background-color: #4da6ff;
            color: white;
            border-radius: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            opacity: 1;
        }

        .export-section {
            margin-top: 10px;
            text-align: center;
        }

        hr {
            margin: 20px 0;
            border: 0;
            border-top: 1px solid #cccccc;
        }

        body.dark-mode hr {
            border-color: #444444;
        }

        .footer {
            text-align: center;
            font-size: 11px;
            color: #666666;
            margin-top: 20px;
        }

        body.dark-mode .footer {
            color: #999999;
        }

        .keyboard-shortcuts {
            font-size: 10px;
            color: #999999;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>One-Sentence Prison</h1>
    <p class="subtitle">"Every sentence is a step forward, no looking back."</p>
    
    <table>
        <tr>
            <td>
                <div class="instructions">
                    <strong>Rules:</strong> Write one sentence at a time. Type a period followed by a space to complete a sentence. 
                    You can only see your most recent sentence until you click "Finish". No editing completed sentences!
                    <div class="keyboard-shortcuts">
                        <strong>Shortcuts:</strong> Ctrl+Enter (Finish), Ctrl+R (Reset), Ctrl+C (Copy), Ctrl+D (Dark Mode), Ctrl+S (Save)
                    </div>
                </div>

                <div class="goals-section">
                    <strong>Goals:</strong> 
                    <label>Sentences: <input type="number" class="goal-input" id="sentenceGoal" value="10" min="1"></label>
                    <label>Words: <input type="number" class="goal-input" id="wordGoal" value="100" min="1"></label>
                    <label>Time (min): <input type="number" class="goal-input" id="timeGoal" value="15" min="1"></label>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div>Progress: <span id="progressText">0%</span> | Session time: <span class="timer-display" id="sessionTimer">00:00</span></div>
                </div>

                <div class="prompt-section" id="promptSection" style="display: none;">
                    <strong>Writing Prompt:</strong> <span id="currentPrompt"></span>
                    <button class="btn" onclick="generatePrompt()" style="margin-left: 10px; padding: 2px 6px; font-size: 10px;">New Prompt</button>
                </div>

                <div class="controls">
                    <button class="btn finish-btn" onclick="finishWriting()">Finish & Reveal All</button>
                    <button class="btn copy-btn" id="copyBtn" onclick="copyText()" disabled>Copy Text</button>
                    <button class="btn reset-btn" onclick="resetEverything()">Reset</button>
                    <button class="btn save-btn" onclick="saveSession()">Save</button>
                    <button class="btn load-btn" onclick="loadSession()">Load</button>
                    <button class="btn toggle-btn" onclick="toggleDarkMode()">🌙</button>
                    <button class="btn" onclick="togglePrompts()">Prompts</button>
                    <button class="btn" onclick="exportText()">Export</button>
                </div>

                <div class="completed-sentences" id="completedSentences">
                    <em style="color: #999;">Your completed sentences will appear here...</em>
                </div>
                
                <textarea 
                    id="currentSentence" 
                    placeholder="Start writing your sentence here..."
                ></textarea>
                
                <div class="stats" id="stats">
                    Sentences: <strong id="sentenceCount">0</strong> | 
                    Total words: <strong id="wordCount">0</strong> | 
                    Current words: <strong id="currentWords">0</strong> |
                    Streak: <strong id="streakCount">0</strong> days
                </div>
            </td>
        </tr>
    </table>

    <hr>
    <div class="footer">
        <em>Focus on one sentence at a time.</em>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        var currentSentenceInput = document.getElementById('currentSentence');
        var completedSentencesDiv = document.getElementById('completedSentences');
        var sentenceCountSpan = document.getElementById('sentenceCount');
        var wordCountSpan = document.getElementById('wordCount');
        var currentWordsSpan = document.getElementById('currentWords');
        var streakCountSpan = document.getElementById('streakCount');
        var copyBtn = document.getElementById('copyBtn');
        var progressFill = document.getElementById('progressFill');
        var progressText = document.getElementById('progressText');
        var sessionTimer = document.getElementById('sessionTimer');
        
        var completedSentences = [];
        var isFinished = false;
        var totalWords = 0;
        var sessionStartTime = Date.now();
        var timerInterval = null;
        var soundEnabled = localStorage.getItem('soundEnabled') !== 'false';

        // Improvement 1: Writing prompts
        var writingPrompts = [
            "A character finds a mysterious key in their pocket that they don't remember putting there.",
            "Two strangers are stuck in an elevator for three hours.",
            "A person discovers they can hear other people's thoughts for exactly one day.",
            "Someone receives a letter addressed to them from 50 years in the future.",
            "A character wakes up to find that everyone else in the world has vanished.",
            "A person finds an old diary that seems to predict their future.",
            "Two enemies are forced to work together to survive.",
            "A character discovers a room in their house they've never seen before.",
            "Someone can only tell the truth for 24 hours.",
            "A person finds out their reflection has been making different choices."
        ];

        // Improvement 2: Session timer
        function startTimer() {
            sessionStartTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            var elapsed = Math.floor((Date.now() - sessionStartTime) / 1000);
            var minutes = Math.floor(elapsed / 60);
            var seconds = elapsed % 60;
            sessionTimer.textContent = 
                (minutes < 10 ? '0' : '') + minutes + ':' + 
                (seconds < 10 ? '0' : '') + seconds;
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        // Improvement 3: Goal tracking and progress
        function updateProgress() {
            var sentenceGoal = parseInt(document.getElementById('sentenceGoal').value) || 10;
            var wordGoal = parseInt(document.getElementById('wordGoal').value) || 100;
            var timeGoal = parseInt(document.getElementById('timeGoal').value) || 15;
            
            var sentenceProgress = (completedSentences.length / sentenceGoal) * 100;
            var wordProgress = (totalWords / wordGoal) * 100;
            var timeElapsed = Math.floor((Date.now() - sessionStartTime) / 60000);
            var timeProgress = (timeElapsed / timeGoal) * 100;
            
            var overallProgress = Math.min(100, (sentenceProgress + wordProgress + timeProgress) / 3);
            
            progressFill.style.width = overallProgress + '%';
            progressText.textContent = Math.round(overallProgress) + '%';
            
            if (overallProgress >= 100 && !isFinished) {
                showNotification('🎉 Congratulations! You\'ve reached your goals!');
                playSound('success');
            }
        }

        // Improvement 4: Sound feedback
        function playSound(type) {
            if (!soundEnabled) return;
            
            var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            var oscillator = audioCtx.createOscillator();
            var gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            if (type === 'complete') {
                oscillator.frequency.value = 800;
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            } else if (type === 'success') {
                // Play a chord
                for (var i = 0; i < 3; i++) {
                    var osc = audioCtx.createOscillator();
                    var gain = audioCtx.createGain();
                    osc.connect(gain);
                    gain.connect(audioCtx.destination);
                    osc.frequency.value = [523, 659, 784][i]; // C, E, G
                    gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                    osc.start();
                    osc.stop(audioCtx.currentTime + 0.5);
                }
                return;
            }
            
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.1);
        }

        // Improvement 5: Notification system
        function showNotification(message) {
            var notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(function() {
                notification.classList.remove('show');
            }, 3000);
        }

        // Improvement 6: Dark mode
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            var isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark);
            showNotification(isDark ? 'Dark mode enabled' : 'Light mode enabled');
        }

        // Improvement 7: Writing prompts
        function generatePrompt() {
            var randomPrompt = writingPrompts[Math.floor(Math.random() * writingPrompts.length)];
            document.getElementById('currentPrompt').textContent = randomPrompt;
        }

        function togglePrompts() {
            var section = document.getElementById('promptSection');
            if (section.style.display === 'none') {
                section.style.display = 'block';
                generatePrompt();
            } else {
                section.style.display = 'none';
            }
        }

        // Improvement 8: Save/Load functionality
        function saveSession() {
            var sessionData = {
                sentences: completedSentences,
                totalWords: totalWords,
                startTime: sessionStartTime,
                currentSentence: currentSentenceInput.value,
                timestamp: Date.now()
            };
            localStorage.setItem('sentencePrisonSession', JSON.stringify(sessionData));
            showNotification('Session saved!');
        }

        function loadSession() {
            var saved = localStorage.getItem('sentencePrisonSession');
            if (saved) {
                var sessionData = JSON.parse(saved);
                completedSentences = sessionData.sentences || [];
                totalWords = sessionData.totalWords || 0;
                sessionStartTime = sessionData.startTime || Date.now();
                currentSentenceInput.value = sessionData.currentSentence || '';
                
                displaySentences();
                updateStats();
                updateProgress();
                startTimer();
                showNotification('Session loaded!');
            } else {
                showNotification('No saved session found');
            }
        }

        // Improvement 9: Streak tracking
        function updateStreak() {
            var today = new Date().toDateString();
            var lastWriteDate = localStorage.getItem('lastWriteDate');
            var currentStreak = parseInt(localStorage.getItem('writingStreak')) || 0;
            
            if (lastWriteDate !== today) {
                var yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (lastWriteDate === yesterday.toDateString()) {
                    currentStreak++;
                } else if (lastWriteDate !== today) {
                    currentStreak = 1;
                }
                
                localStorage.setItem('lastWriteDate', today);
                localStorage.setItem('writingStreak', currentStreak);
            }
            
            streakCountSpan.textContent = currentStreak;
        }

        // Improvement 10: Export functionality
        function exportText() {
            if (completedSentences.length === 0) {
                showNotification('No text to export');
                return;
            }
            
            var text = completedSentences.join(' ');
            var blob = new Blob([text], { type: 'text/plain' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'sentence-prison-' + new Date().toISOString().split('T')[0] + '.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showNotification('Text exported!');
        }

        // Copy functionality (requested feature)
        function copyText() {
            if (completedSentences.length === 0) {
                showNotification('No text to copy');
                return;
            }
            
            var text = completedSentences.join(' ');
            navigator.clipboard.writeText(text).then(function() {
                showNotification('Text copied to clipboard!');
            }).catch(function() {
                // Fallback for older browsers
                var textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showNotification('Text copied to clipboard!');
            });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'Enter':
                        e.preventDefault();
                        finishWriting();
                        break;
                    case 'r':
                        e.preventDefault();
                        resetEverything();
                        break;
                    case 'c':
                        if (isFinished) {
                            e.preventDefault();
                            copyText();
                        }
                        break;
                    case 'd':
                        e.preventDefault();
                        toggleDarkMode();
                        break;
                    case 's':
                        e.preventDefault();
                        saveSession();
                        break;
                }
            }
        });

        // Original functions with improvements
        function updateStats() {
            var currentText = currentSentenceInput.value.trim();
            var currentWordCount = currentText === '' ? 0 : currentText.split(/\s+/).length;
            
            sentenceCountSpan.textContent = completedSentences.length;
            wordCountSpan.textContent = totalWords + currentWordCount;
            currentWordsSpan.textContent = currentWordCount;
            
            updateProgress();
            updateStreak();
        }

        function displaySentences() {
            if (completedSentences.length === 0) {
                completedSentencesDiv.innerHTML = '<em style="color: #999;">Your completed sentences will appear here...</em>';
                return;
            }

            var html = '';
            if (isFinished) {
                html = '<div class="text-block visible">' + completedSentences.join(' ') + '</div>';
            } else {
                if (completedSentences.length === 1) {
                    html = '<div class="text-block visible"><span class="current-sentence">' + completedSentences[0] + '</span></div>';
                } else {
                    var olderSentences = completedSentences.slice(0, -1).join(' ');
                    var currentSentence = completedSentences[completedSentences.length - 1];
                    
                    html = '<div class="text-block typewriter-mode">' + olderSentences + '</div>';
                    if (olderSentences.length > 0) {
                        html += ' ';
                    }
                    html += '<div class="text-block visible"><span class="current-sentence">' + currentSentence + '</span></div>';
                }
            }
            
            completedSentencesDiv.innerHTML = html;
            completedSentencesDiv.scrollTop = completedSentencesDiv.scrollHeight;
        }

        function completeSentence() {
            var text = currentSentenceInput.value.trim();
            if (text.length > 0) {
                var sentence = text.replace(/\.\s*$/, '').trim() + '.';
                completedSentences.push(sentence);
                
                var wordsInSentence = sentence.split(/\s+/).length;
                totalWords += wordsInSentence;
                
                currentSentenceInput.value = '';
                
                displaySentences();
                updateStats();
                playSound('complete');
                
                currentSentenceInput.focus();
            }
        }

        function finishWriting() {
            var currentText = currentSentenceInput.value.trim();
            if (currentText.length > 0 && !currentText.match(/\.\s*$/)) {
                var sentence = currentText + (currentText.endsWith('.') ? '' : '.');
                completedSentences.push(sentence);
                var wordsInSentence = sentence.split(/\s+/).length;
                totalWords += wordsInSentence;
                currentSentenceInput.value = '';
            }
            
            isFinished = true;
            displaySentences();
            updateStats();
            stopTimer();
            currentSentenceInput.disabled = true;
            currentSentenceInput.placeholder = "Writing session completed. Click Reset to start over.";
            copyBtn.disabled = false;
            showNotification('Writing session completed!');
        }

        function resetEverything() {
            if (completedSentences.length > 0 || currentSentenceInput.value.trim().length > 0) {
                if (!confirm('Clear all sentences and start over?')) {
                    return;
                }
            }
            
            completedSentences = [];
            totalWords = 0;
            isFinished = false;
            currentSentenceInput.disabled = false;
            currentSentenceInput.value = '';
            currentSentenceInput.placeholder = "Start writing your sentence here...";
            copyBtn.disabled = true;
            stopTimer();
            displaySentences();
            updateStats();
            startTimer();
            currentSentenceInput.focus();
        }

        // Event listeners
        currentSentenceInput.addEventListener('input', function() {
            var text = this.value;
            updateStats();
            
            if (text.match(/\.\s$/)) {
                completeSentence();
            }
        });

        currentSentenceInput.addEventListener('keydown', function(e) {
            updateStats();
        });

        // Initialize
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
        }
        updateStats();
        startTimer();
        currentSentenceInput.focus();
    </script>
</body>
</html>
